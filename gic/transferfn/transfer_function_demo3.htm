<!DOCTYPE html>
<html>
<body>
<h2>
Effect of frequency domain smoothing on prediction of the geoelectric field from the surface geomagnetic field</h2>

<p>Draft</p>

<h3>Abstract</h3>
We show that common methods of computing the geoelectric field/geomagnetic field transfer function based on frequency domain smoothing lead to inferior predictions compared to a straightforward time domain method.  

<h3>Overview</h3>

<p>
An input signal <code>B<sub>x</sub></code> of length <code>N = 10<sup>4</sup></code> is filtered using a discrete approximation of an exponential low-pass filter: <code>h(t) = (1-1/10)<sup>t</sup>, t = 0, 1, ..., 100</code> with <code>h(0) = 0</code> to create output signal <code>E<sub>y</sub></code>.  Noise is added to both the input and output signal.  Note that this transfer function is a rough approximation of a MT transfer function between dBx/dt and Ey.  In the following, Bx is used instead of dBx/dt for to simplify notation.  A more realistic transfer function decays as 1/t<sup>3/2</sup> and requires special treatment at t=0.
</p>

<p>
Different methods are compared for computing the transfer function and impulse response.  The computed impulse response or transfer function for each method is used to generate a prediction.
</p>

<h4>Time Domain Method</h4>
<p>
The time domain method is based on estimating the coefficients <b>h</b> in the over-determined matrix equation <b>E</b><sub>y</sub> = <b>B</b><sub>x</sub><b>h</b>, where <b>E</b><sub>y</sub><code> = [Ey(0);Ey(1);...;Ey(N-n<sub>T</sub>)]</code> and <b>B</b><sub>x</sub><code> = [Bx(1), Bx(2), ... , Bx(n<sub>T</sub>), 1 ; Bx(2), Bx(3), ..., Bx(n<sub>T</sub>+1), 1; ...; Bx(N-n<sub>T</sub>+1), Bx(N-n<sub>T</sub>+2), ..., Bx(N), 1]</code>.  (Notation: commas separate columns and semi-colons separate rows.) The total number of rows of  <code><b>B</b><sub>x</sub></code> is <code>N-n<sub>T</sub></code>, where <code>N</code> is the length of the input signal.  Without noise and with <code>n<sub>T</sub> = 100</code>, we expect to recover the exact <b>h</b>.
</p>

<h4>Frequency Domain Method - Rectangular</h4>
<p>
The Rectangular frequency domain method is based on computing the raw periodogram of the length <code>N</code> signals <code>E<sub>y</sub></code> and <code>B<sub>x</sub></code> and applying a box-car window of width <code>n<sub>R</sub></code> to the cross- and auto-spectra to compute the transfer function. To compute the predictions, the transfer functions are interpolated on to the uniform frequency grid <code>f = 0, 1/N, ..., 1/2</code>prior to convolving with B.
</p>

<h4>Frequency Domain Method - Parzen</h4>
<p>
The Parzen frequency domain method is based on <i>Simpson and Bahr</i> [2005] (chapter 4).  The raw periodogram of each signal of length <code>N</code> is smoothed in the frequency domain applying a Parzen window on points centered on evaluation frequencies.  The computed evaluation frequencies are <code>fe = 2<sup>-(k+3)/2</sup></code> for all positive integers <code>k</code> for which <code>fe < 1/N</code>, i.e., <code>k<sub>max</sub> = floor(2log<sub>2</sub>N-3)</code>.   The windowed cross- and auto-spectra are used to compute the transfer function.  For <code>N = 10<sup>4</sup></code>, the number of evaluation frequencies is <code>n<sub>P</sub> = 23</code>.  The actual evaluation frequencies used are the nearest larger frequencies to <code>f = 0, 1/N, ..., 1/4</code>.  To compute the predictions, the transfer functions are interpolated on to the uniform frequency grid <code>f = 0, 1/N, ..., 1/2</code>prior to convolving with B.
</p>
<h3>Code</h3>
<a href="https://github.com/rweigel/m-rsw/blob/gh-pages/gic/transferfn/transfer_function_demo3.m">gic/transferfn/transfer_function_demo3.m</a>
<br style="clear:both"/>
<h3>Figures</h3>
<table style="margin-bottom:1em;display:block" border="1" cellpadding="2" width="1826px" align="left">
	<tbody style="overflow-x:auto">
		<tr>
			<td style="vertical-align:top">
				<img title="" src="figures/transfer_function_demo3_timeseries.png" width="600px">
			</td>
			<td style="vertical-align:top">
			</td>
			<td style="vertical-align:top">
			</td>
		</tr>
		<tr>
			<td style="vertical-align:top">
				<img title="" src="figures/transfer_function_demo3_crosscorrelation.png" width="600px">
			</td>
			<td style="vertical-align:top">
				<img title="" src="figures/transfer_function_demo3_rawperiodograms.png" width="600px">
			</td>
			<td style="vertical-align:top">
			</td>
		</tr>
		<tr>
			<td style="vertical-align:top">
				<img title="" src="figures/transfer_function_demo3_impulse_responses.png" width="600px">
				<div style="display:block"></div>
			</td>
			<td style="vertical-align:top">
				<img title="" src="figures/transfer_function_demo3_impulse_response_errors.png" width="600px">
				<div style="display:block"></div>
			</td>
			<td style="vertical-align:top">
				
			</td>
		</tr>
		<tr>
			<td style="vertical-align:top">
				<img title="" src="figures/transfer_function_demo3_transfer_functions.png" width="600px">
				<div style="display:block"></div>
			</td>
			<td style="vertical-align:top">
				<img title="" src="figures/transfer_function_demo3_transfer_function_errors.png" width="600px">
				<div style="display:block"></div>
			</td>
			<td style="vertical-align:top">
				
			</td>
		</tr>
		<tr>
			<td style="vertical-align:top">
				<img title="" src="figures/transfer_function_demo3_transfer_function_phases.png" width="600px">
				<div style="display:block"></div>
			</td>
			<td style="vertical-align:top">
				<img title="" src="figures/transfer_function_demo3_transfer_function_phase_errors.png" width="600px">
				<div style="display:block"></div>
			</td>
			<td style="vertical-align:top">
				
			</td>
		</tr>
		<tr>
			<td style="vertical-align:top">
				<img title="" src="figures/transfer_function_demo3_predictions.png" width="600px">
				<div style="display:block"></div>
			</td>
			<td style="vertical-align:top">
				<img title="" src="figures/transfer_function_demo3_prediction_errors.png" width="600px">
				<div style="display:block"></div>
			</td>
			<td style="vertical-align:top">
				
			</td>
		</tr>

</tbody>
</table>
</body>
</html>